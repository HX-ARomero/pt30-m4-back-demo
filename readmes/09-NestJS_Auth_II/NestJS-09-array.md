# Nest JS - Nest JS Authentication II

[Volver a Inicio](../../README.md)

## ๐ค Autenticaciรณn

<img src="./assets/09-01(array).png" style="margin: 20px 0 60px 0">

## ๐ Autorizaciรณn

<img src="./assets/09-02(array).png" style="margin: 20px 0 60px 0">

---

## ๐ DATAFLOW: AUTENTICACIรN Y AUTORIZACIรN (JWT)

```txt
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          DATAFLOW: AUTENTICACIรN Y AUTORIZACIรN (JWT)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโ VALIDAR IDENTIDAD DEL USUARIO Y ROL (Autenticaciรณn) โโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1) LOGIN REQUEST                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ El cliente envรญa por BODY:                                        โ
โ    { username, password }                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2) AUTHSERVICE                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ * Verifica username y password                                    โ
โ * Si son vรกlidos โ firma JWT                                      โ
โ * Payload incluye:                                                โ
โ     { id, roles: ["admin"] | ["user"] | ["admin", "user"] | ... } โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3) RESPUESTA AL CLIENTE                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Se envรญa:                                                         โ
โ      { accessToken }                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโ ACCESO A RUTAS PROTEGIDAS (Autorizaciรณn) โโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4) REQUEST A RUTA PROTEGIDA                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ El cliente envรญa por HEADERS:                                     โ
โ    Authorization: Bearer <token>                                  โ
โ      En Payload: { id, roles: ["admin"] | ["user"] | ... }        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5) AUTHGUARD                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ * Verifica validez del JWT                                        โ
โ * Si es vรกlido โ adjunta payload en:                              โ
โ      request.user                                                 โ
โ          { id, roles: ["admin"] | ["user"] | ... }                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6) ROLES GUARD                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ * Lee Metadata de la ruta (@Roles("admin"))                       โ
โ * Compara:                                                        โ
โ      Metadata.roles        : ["admin"]                            โ
โ            VS                                                     โ
โ      request.user.roles    : ["admin"] | ["user]                  โ
โ * Si coinciden โ acceso permitido                                 โ
โ x Si no coinciden โ ForbiddenException (403)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                     โโโโโโโโโโโโโโโโโโโโโ
                     โ  CONTROLLER       โ
                     โ  (Ruta ejecutada) โ
                     โโโโโโโโโโโโโโโโโโโโโ

```

---

[Volver a Inicio](../../README.md)
